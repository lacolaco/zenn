---
title: "1-1. コンポーネントの分割"
---

1-1節では、複数の責任を持ったコンポーネントをリファクタリングし、メンテナンスしやすい単一責任のコンポーネントへと分割を進めるパターンを学びます。

## コンポーネントの責任

現在の`AppComponent`は次のようになっています。

```html:app.component.html
<ul>
  <li *ngFor="let user of users">
    #{{ user.id }} {{ user.first_name }} {{ user.last_name }}
  </li>
</ul>
```

```ts:app.component.ts
@Component({
  selector: 'my-app',
  templateUrl: './app.component.html',
  styleUrls: ['./app.component.css']
})
export class AppComponent {
  users: User[] = [];

  constructor(private http: HttpClient) { }

  ngOnInit() {
    this.http.get<{ data: User[] }>('https://reqres.in/api/users').subscribe(resp => {
      this.users = resp.data;
    });
  }
}
```

今の`AppComponent`は次のようなたくさんの責任を負っています。

1. [アプリケーションブートストラップ](https://angular.jp/guide/glossary#%E3%83%96%E3%83%BC%E3%83%88%E3%82%B9%E3%83%88%E3%83%A9%E3%83%83%E3%83%97)に使われる[ルートコンポーネント](https://angular.jp/guide/bootstrapping#bootstrap%E9%85%8D%E5%88%97)となること 
2. ユーザーの配列をAPIから取得すること
3. ユーザーの配列をリストとして表示すること
4. ユーザーの情報を表示すること

これは[**単一責任原則**](https://xn--97-273ae6a4irb6e2hsoiozc2g4b8082p.com/%E3%82%A8%E3%83%83%E3%82%BB%E3%82%A4/%E5%8D%98%E4%B8%80%E8%B2%AC%E4%BB%BB%E5%8E%9F%E5%89%87/)に反しています。このままでは、`AppComponent`はいくつもの理由で変更されることになります。1つめのルートコンポーネントとしての役割は捨てることができないものですが、それ以外の責任はそれぞれを担当するコンポーネントに分割することができます。

まずはリストで反復される単位要素を分割することで、ひとつの責任を別のモジュールに切り出すことにしましょう。

## `UserListItemComponent` の分割

ユーザーリストの繰り返し単位のコンポーネントを `UserListItemComponent` として分割します。このコンポーネントの責任は、渡された1件のユーザーをリストアイテムとして表示することです。それ以外の理由でこのコンポーネントが変更されてはいけません。

コンポーネントの分割は次のような手順で行います。

1. 新しいコンポーネントのファイルを作成する（`ng g component`）
2. 元のコンポーネントのテンプレートから新しいコンポーネントに分割したい範囲を移植する
3. 新しいコンポーネントに必要なプロパティやメソッドを定義する
4. 元のコンポーネントのテンプレートを新しいコンポーネントで置き換える

`UserListItemComponent`のために切り出されるテンプレートは次の範囲です。

```html:user-list-item.component.html
#{{ user.id }} {{ user.first_name }} {{ user.last_name }}
```

このテンプレートに必要な `user` プロパティを定義し、親コンポーネントからデータを受け取るためにインプットとして機能するようにします。
`UserListItemComponent` は次のようになります。

```typescript:user-list-item.component.ts
import { Component, ChangeDetectionStrategy, Input } from '@angular/core';
import { User } from '../../user';

@Component({
  selector: 'user-list-item',
  templateUrl: './user-list-item.component.html',
  changeDetection: ChangeDetectionStrategy.OnPush
})
export class UserListItemComponent {
  @Input()
  user: User;
}
```

次のように`AppComponent`のテンプレートの一部を`UserListItemComponent`で置き換えます。これで`AppComponent`はユーザー情報の表示に関する責任から開放されました。たとえばユーザーのメールアドレスを表示することになっても、`AppComponent`を変更する必要はありません。

```html:app.component.html
<ul>
  <li *ngFor="let user of users">
    <user-list-item [user]="user"></user-list-item>
  </li>
</ul>
```

## `UserListComponent`の分割

続いてもうひとつの責任、ユーザーの配列をどのようにリストとして表示するかという関心事を`AppComponent`から切り出すことにしましょう。同じように新しく `UserListComponent` を作成し、テンプレートを切り出します。

```typescript:user-list.component.ts
import { Component, ChangeDetectionStrategy, Input } from '@angular/core';
import { User } from '../../user';

@Component({
  selector: 'user-list',
  templateUrl: './user-list.component.html',
  changeDetection: ChangeDetectionStrategy.OnPush,
})
export class UserListComponent {

  @Input()
  users!: User[];
}
```

```html:user-list.component.html
<ul>
  <li *ngFor="let user of users">
    <user-list-item [user]="user"></user-list-item>
  </li>
</ul>
```

結果として、`AppComponent`のテンプレートは次のようになります。`AppComponent`が持つ責任は、アプリケーションのルートコンポーネントであることと、ユーザーリストのデータを配列として取得することになりました。ユーザーリストをどのように表示するかというUIの関心事は`UserListComponent`と`UserListItemComponent`に分離できました。

```html:app.component.html
<user-list [users]="users"></user-list>
```

@[stackblitz](https://stackblitz.com/edit/angular-brjyhu?embed=1&file=src%2Fapp%2Fapp.component.html)


## ここまでのまとめ

このセクションでは`UserListComponent` と `UserListItemComponent` を作成し、`AppComponent`の責任の一部を移譲するリファクタリングをおこないました。UIの責任はほとんど`AppComponent`から切り出すことができましたが、`AppCompoent`にはまだ切り出せる責任が残っています。
次はユーザーのデータを取得する責任を**サービス**に切り出すリファクタリングへ進みましょう。

<!-- 1.2はここに結合する -->